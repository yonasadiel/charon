#include <stdio.h>
#include <time.h>
#include <assert.h>
#include <gmp.h>

int main() {
  int t = 1000000;  // guess
  mpz_t b, p, q, n, expected, r, exp, one;
  mpz_init(b);
  mpz_init(p);
  mpz_init(q);
  mpz_init(n);
  mpz_init(expected);
  mpz_init(r);
  mpz_init(exp);
  mpz_init(one);
  mpz_set_ui(b, 2);
  mpz_set_str(p, "66203613995635620068950459585648335905192092089967823434921498695066471577332899402286163668773513934998384744366112949966982164771114427612757121196328525928630707676069888137088462085575745552319061198646810526835770222804881957424533401399482485861872741495470250988350625365322286114880045876705802328631", 10);
  mpz_set_str(q, "102750227528554553361067481351001413240819233250343345470341671156187505617037010409537721059907229321759571134310613932058514709407260831014149748507625248253675492654075295493475541008302371641073777410900718908246809244281099778100742892350520227068750164955829225899636100683052203775191842210275055224993", 10);
  mpz_set_str(expected, "1235686480410350321709050679223516474113481857848518742337444664059543564886011878564213023899819350015982875600268261603327443124177467218954322487838692303594730639377975672669423357033282912779593534668185478080816773004343217244397858513055153705290373549032761624637233396879038508518304077125917944516081372693863645624591399121709922071610444437700417145274350328404164534620943892396382992812696252045989908089590715065059627493925666564939094931043316883166701115140236645290058689371326040451483928431261694862203562347703711786144009767263588363655906853126667682872762807870358050001653481573073152617986", 10);
  mpz_mul(n, p, q);\
  mpz_set_ui(one, 1);
  mpz_mul_2exp(exp, one, t);

  clock_t begin = clock();
  mpz_powm(r, b, exp, n);
  clock_t end = clock();

  assert(mpz_cmp(r, expected) == 0);
  double elapsed_secs = (double) (end - begin) / CLOCKS_PER_SEC;

  printf("Squarings per second (C + GMP): %.10f\n", (double) t / elapsed_secs);
}
